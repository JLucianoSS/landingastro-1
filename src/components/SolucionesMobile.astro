---
import SolucionModal from './SolucionModal.astro';
import { solucionesData } from '../data/soluciones';

// Mapeo de IDs de las cards a los datos
const cardDataMap = {
  'conectividad-avanzada': solucionesData[0],
  'cloud-plataformas-digitales': solucionesData[1], 
  'data-center': solucionesData[2],
  'gobierno-riesgo-cumplimiento': solucionesData[3],
  'confianza-digital-identidades': solucionesData[4],
  'proteccion-avanzada-amenazas': solucionesData[5],
  'tecnologias-nueva-generacion': solucionesData[6],
  'proteccion-experiencia-digital': solucionesData[7]
};
---

<section
  id="soluciones-mobile"
  class="py-20 bg-gradient-to-br from-slate-50 via-white to-blue-50 relative overflow-hidden"
>
  <div class="container mx-auto px-4">
    <!-- T√≠tulo y subt√≠tulo de la secci√≥n -->
    <div class="text-center md:mb-40">
      <h2
        class="soluciones-titulo font-stolzl text-3xl md:text-4xl md:text-5xl font-bold bg-gradient-to-r from-[#050835] to-[#3b4ef7] bg-clip-text text-transparent mb-6"
        data-aos="fade-down"
        data-aos-delay="100"
        data-aos-duration="600"
      >
        Ecosistema de Soluciones
      </h2>
      <p
        class="soluciones-subtitulo text-lg md:text-xl text-dark/70 max-w-3xl mx-auto leading-relaxed"
        data-aos="fade-up"
        data-aos-delay="300"
        data-aos-duration="600"
      >
        Conectamos todas las piezas de tu transformaci√≥n digital donde creamos
        valor a trav√©s de soluciones integradas que potencian el crecimiento de
        tu organizaci√≥n
      </p>
    </div>
    <div class="ecosystem-wrapper relative w-full max-w-6xl mx-auto h-[700px]">
      <!-- Part√≠culas de fondo -->
      <div
        class="bg-particle absolute w-1 h-1 bg-secondary/20 rounded-full"
        style="top: 10%; left: 15%;"
      >
      </div>
      <div
        class="bg-particle absolute w-1 h-1 bg-secondary/20 rounded-full"
        style="top: 20%; right: 20%;"
      >
      </div>
      <div
        class="bg-particle absolute w-1 h-1 bg-secondary/20 rounded-full"
        style="bottom: 30%; left: 25%;"
      >
      </div>
      <div
        class="bg-particle absolute w-1 h-1 bg-secondary/20 rounded-full"
        style="bottom: 15%; right: 30%;"
      >
      </div>

      <!-- SVG para l√≠neas de conexi√≥n -->
      <svg
        class="hidden md:flex connection-svg absolute inset-0 w-full h-full pointer-events-none z-10"
        viewBox="0 0 800 600"
      >
        <defs>
          <linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#e2e8f0;stop-opacity:1"></stop>
            <stop offset="100%" style="stop-color:#062BED;stop-opacity:0.8"
            ></stop>
          </linearGradient>
        </defs>

        <!-- L√≠neas que llegan EXACTAMENTE a cada card -->
        <!-- Seguridad -> Centro -->
        <path
          class="connection-line line-1"
          d="M400 80 L400 250"
          stroke="#e2e8f0"
          stroke-width="2"
          fill="none"></path>

        <!-- Cloud -> Centro -->
        <path
          class="connection-line line-2"
          d="M850 140 L400 250"
          stroke="#e2e8f0"
          stroke-width="2"
          fill="none"></path>

        <!-- IA/ML -> Centro -->
        <path
          class="connection-line line-3"
          d="M700 450 L400 250"
          stroke="#e2e8f0"
          stroke-width="2"
          fill="none"></path>

        <!-- DevOps -> Centro -->
        <path
          class="connection-line line-4"
          d="M400 480 L400 250"
          stroke="#e2e8f0"
          stroke-width="2"
          fill="none"></path>

        <!-- Data -> Centro -->
        <path
          class="connection-line line-5"
          d="M100 440 L400 250"
          stroke="#e2e8f0"
          stroke-width="2"
          fill="none"></path>

        <!-- IoT -> Centro -->
        <path
          class="connection-line line-6"
          d="M100 170 L400 250"
          stroke="#e2e8f0"
          stroke-width="2"
          fill="none"></path>

        <!-- Protecci√≥n Avanzada -> Centro -->
        <path
          class="connection-line line-7"
          d="M800 290 L400 250"
          stroke="#e2e8f0"
          stroke-width="2"
          fill="none"></path>

        <!-- Tecnolog√≠as Nueva Generaci√≥n -> Centro -->
        <path
          class="connection-line line-8"
          d="M10 280 L400 250"
          stroke="#e2e8f0"
          stroke-width="2"
          fill="none"></path>

        <!-- Punto central (enchufe) -->
        <circle
          class="connection-dot center-dot"
          cx="400"
          cy="250"
          r="6"
          fill="#062BED"></circle>

        <!-- Puntos de conexi√≥n -->
        <circle
          class="connection-dot dot-1"
          cx="400"
          cy="80"
          r="4"
          fill="#e2e8f0"></circle>
        <circle
          class="connection-dot dot-2"
          cx="580"
          cy="140"
          r="4"
          fill="#e2e8f0"></circle>
        <circle
          class="connection-dot dot-3"
          cx="580"
          cy="360"
          r="4"
          fill="#e2e8f0"></circle>
        <circle
          class="connection-dot dot-4"
          cx="400"
          cy="480"
          r="4"
          fill="#e2e8f0"></circle>
        <circle
          class="connection-dot dot-5"
          cx="220"
          cy="360"
          r="4"
          fill="#e2e8f0"></circle>
        <circle
          class="connection-dot dot-6"
          cx="220"
          cy="140"
          r="4"
          fill="#e2e8f0"></circle>
        <circle
          class="connection-dot dot-7"
          cx="580"
          cy="190"
          r="4"
          fill="#e2e8f0"></circle>
        <circle
          class="connection-dot dot-8"
          cx="220"
          cy="190"
          r="4"
          fill="#e2e8f0"></circle>
      </svg>

      <!-- Card central con logo - Dise√±o profesional -->
      <div
        class="center-card absolute md:top-[42%] md:left-[50%] top-[50%] left-[50%] w-36 h-36 md:w-52 md:h-52 bg-[#050835]/90 backdrop-blur-md rounded-full flex items-center justify-center z-20 shadow-lg border border-white/30"
        style="transform: translate(-50%, -50%);"
        data-aos="zoom-in"
        data-aos-delay="200"
        data-aos-duration="800"
      >
        <div class="text-center">
          <!-- Logo Imperia -->
          <img
            src="/images/logo-hero.png"
            alt="Imperia"
            class="w-24 h-10 md:w-36 md:h-18 mx-auto object-contain"
          />
        </div>
      </div>

      <!-- Tarjetas de soluciones - Mejor alineamiento del texto -->
      <!-- 1. Seguridad (arriba centro) -->
      <div
        class="solution-card card-1 absolute md:top-[-60px] md:left-[50%] top-[-80px] left-[50%] w-36 h-36 bg-[#062BED] backdrop-blur-sm rounded-full shadow-lg border border-white/20 z-40 flex items-center justify-center cursor-pointer"
        style="transform: translateX(-50%);"
        data-connection="1"
        data-solucion-id="proteccion-experiencia-digital"
        onclick="openModal('proteccion-experiencia-digital')"
        data-aos="fade-down"
        data-aos-delay="400"
        data-aos-duration="600"
      >
        <div class="flex flex-col items-center text-center px-4">
          <div
            class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-2 shadow-lg"
          >
            <img
              src="/images/soluciones/proteccion-experiencia.png"
              alt="Protecci√≥n de la Experiencia Digital"
              class="w-8 h-8 object-contain"
            />
          </div>
          <h4 class="font-bold text-white text-sm leading-tight">
            Protecci√≥n de la Experiencia Digital
          </h4>
        </div>
      </div>

      <!-- 2. Cloud (arriba derecha) -->
      <div
        class="solution-card card-2 absolute w-36 h-36 bg-[#062BED] backdrop-blur-sm rounded-full shadow-lg border border-white/20 z-30 flex items-center justify-center cursor-pointer"
        style="top: 20px; right: 40px;"
        data-connection="2"
        data-solucion-id="conectividad-avanzada"
        onclick="openModal('conectividad-avanzada')"
        data-aos="fade-left"
        data-aos-delay="500"
        data-aos-duration="600"
      >
        <div class="flex flex-col items-center text-center px-4">
          <div
            class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-2 shadow-lg"
          >
            <img
              src="/images/soluciones/conectividad-avanzada.png"
              alt="Conectividad Avanzada"
              class="w-8 h-8 object-contain"
            />
          </div>
          <h4 class="font-bold text-white text-sm leading-tight">Conectividad Avanzada</h4>
        </div>
      </div>

      <!-- 3. IA/ML (abajo derecha) -->
      <div
        class="solution-card card-3 absolute w-36 h-36 bg-[#062BED] backdrop-blur-sm rounded-full shadow-lg border border-white/20 z-30 flex items-center justify-center cursor-pointer"
        style="bottom: 40px; right: 40px;"
        data-connection="3"
        data-solucion-id="cloud-plataformas-digitales"
        onclick="openModal('cloud-plataformas-digitales')"
        data-aos="fade-up-left"
        data-aos-delay="600"
        data-aos-duration="600"
      >
        <div class="flex flex-col items-center text-center px-4">
          <div
            class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-2 shadow-lg"
          >
            <img
              src="/images/soluciones/cloud-plat.png"
              alt="Cloud & Plataformas Digitales"
              class="w-8 h-8 object-contain"
            />
          </div>
          <h4 class="font-bold text-white text-sm leading-tight">
            Cloud & Plataformas Digitales
          </h4>
        </div>
      </div>

      <!-- 4. DevOps (abajo centro) -->
      <div
        class="solution-card card-4 absolute w-36 h-36 bg-[#062BED] backdrop-blur-sm rounded-full shadow-lg border border-white/20 z-40 flex items-center justify-center cursor-pointer"
        style="bottom: 20px; left: 50%; transform: translateX(-50%);"
        data-connection="4"
        data-solucion-id="data-center"
        onclick="openModal('data-center')"
        data-aos="fade-up"
        data-aos-delay="700"
        data-aos-duration="600"
      >
        <div class="flex flex-col items-center text-center px-4">
          <div
            class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-2 shadow-lg"
          >
            <img
              src="/images/soluciones/data-center.png"
              alt="Data Center"
              class="w-8 h-8 object-contain"
            />
          </div>
          <h4 class="font-bold text-white text-sm leading-tight">Data Center</h4>
        </div>
      </div>

      <!-- 5. Data (abajo izquierda) -->
      <div
        class="solution-card card-5 absolute w-36 h-36 bg-[#062BED] backdrop-blur-sm rounded-full shadow-lg border border-white/20 z-30 flex items-center justify-center cursor-pointer"
        style="bottom: 20px; left: 40px;"
        data-connection="5"
        data-solucion-id="gobierno-riesgo-cumplimiento"
        onclick="openModal('gobierno-riesgo-cumplimiento')"
        data-aos="fade-up-right"
        data-aos-delay="800"
        data-aos-duration="600"
      >
        <div class="flex flex-col items-center text-center px-4">
          <div
            class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-2 shadow-lg"
          >
            <img
              src="/images/soluciones/gob-riesgo-cum.png"
              alt="Gobierno, Riesgo y Cumplimiento"
              class="w-8 h-8 object-contain"
            />
          </div>
          <h4 class="font-bold text-white text-sm leading-tight">
            Gobierno, Riesgo y Cumplimiento
          </h4>
        </div>
      </div>

      <!-- 6. IoT (arriba izquierda) -->
      <div
        class="solution-card card-6 absolute w-36 h-36 top-[40px] left-[40px] bg-[#062BED] backdrop-blur-sm rounded-full shadow-lg border border-white/20 z-30 flex items-center justify-center cursor-pointer"
        style=""
        data-connection="6"
        data-solucion-id="confianza-digital-identidades"
        onclick="openModal('confianza-digital-identidades')"
        data-aos="fade-right"
        data-aos-delay="900"
        data-aos-duration="600"
      >
        <div class="flex flex-col items-center text-center px-4">
          <div
            class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-2 shadow-lg"
          >
            <img
              src="/images/soluciones/confianza-digital.png"
              alt="Confianza Digital y Protecci√≥n de Identidades"
              class="w-8 h-8 object-contain"
            />
          </div>
          <h4 class="font-bold text-white text-sm leading-tight">
            Confianza Digital y Protecci√≥n de Identidades
          </h4>
        </div>
      </div>

      <!-- 7. Protecci√≥n Avanzada Contra Amenazas (nueva posici√≥n) -->
      <div
        class="solution-card card-7 absolute md:top-[284px] md:right-[-20px] top-[254px] right-[-10px] w-36 h-36 bg-[#062BED] backdrop-blur-sm rounded-full shadow-lg border border-white/20 z-30 flex items-center justify-center cursor-pointer"
        style=""
        data-connection="7"
        data-solucion-id="proteccion-avanzada-amenazas"
        onclick="openModal('proteccion-avanzada-amenazas')"
        data-aos="fade-left"
        data-aos-delay="1000"
        data-aos-duration="600"
      >
        <div class="flex flex-col items-center text-center px-4">
          <div
            class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-2 shadow-lg"
          >
            <img
              src="/images/soluciones/proteccion-avanzada-amenazas.png"
              alt="Protecci√≥n Avanzada Contra Amenazas"
              class="w-8 h-8 object-contain"
            />
          </div>
          <h4 class="font-bold text-white text-sm leading-tight">
            Protecci√≥n Avanzada Contra Amenazas
          </h4>
        </div>
      </div>

      <!-- 8. Tecnolog√≠as de Nueva Generaci√≥n (nueva posici√≥n) -->
      <div
        class="solution-card card-8 absolute md:top-[250px] md:left-[-20px] top-[254px] left-[-10px] w-36 h-36 bg-[#062BED] backdrop-blur-sm rounded-full shadow-lg border border-white/20 z-30 flex items-center justify-center cursor-pointer"
        style=""
        data-connection="8"
        data-solucion-id="tecnologias-nueva-generacion"
        onclick="openModal('tecnologias-nueva-generacion')"
        data-aos="fade-right"
        data-aos-delay="1100"
        data-aos-duration="600"
      >
        <div class="flex flex-col items-center text-center px-4">
          <div
            class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center mb-2 shadow-lg"
          >
            <img
              src="/images/soluciones/tec-nueva-generacion.png"
              alt="Tecnolog√≠as de Nueva Generaci√≥n"
              class="w-8 h-8 object-contain"
            />
          </div>
          <h4 class="font-bold text-white text-sm leading-tight">
            Tecnolog√≠as de Nueva Generaci√≥n
          </h4>
        </div>
      </div>
    </div>
  </div>

  <!-- Modales para cada soluci√≥n -->
  {Object.entries(cardDataMap).map(([id, data]) => (
    <SolucionModal
      id={data.id}
      title={data.title}
      description={data.description}
      features={data.features}
      highlightedFeatures={data.highlightedFeatures}
      icon={data.icon}
      isOpen={false}
    />
  ))}
</section>

<script>
  // Script espec√≠fico para manejar modales en mobile
  document.addEventListener('DOMContentLoaded', function() {
    console.log('üì± SolucionesMobile: Inicializando modales...');
    
    // Funci√≥n para abrir modal
    function openModal(modalId) {
      console.log('üì± Abriendo modal:', modalId);
      const modal = document.getElementById('modal-' + modalId);
      console.log('üì± Modal encontrado:', modal);
      
      if (modal) {
        console.log('üì± Agregando clase modal-open...');
        modal.classList.add('modal-open');
        document.body.style.overflow = 'hidden';
        
        // Forzar visibilidad inmediata
        modal.style.display = 'flex';
        modal.style.opacity = '1';
        modal.style.visibility = 'visible';
        
        // Animaci√≥n de entrada
        const modalContent = modal.querySelector('.modal-container');
        console.log('üì± Modal content encontrado:', modalContent);
        
        if (modalContent) {
          modalContent.style.transform = 'scale(0.8) translateY(50px)';
          modalContent.style.opacity = '0';
          
          setTimeout(function() {
            modalContent.style.transition = 'all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
            modalContent.style.transform = 'scale(1) translateY(0)';
            modalContent.style.opacity = '1';
          }, 10);
        }
        console.log('‚úÖ Modal abierto:', modalId);
      } else {
        console.error('‚ùå Modal no encontrado:', modalId);
        // Debug: listar todos los modales disponibles
        const allModals = document.querySelectorAll('[id^="modal-"]');
        console.log('üì± Todos los modales disponibles:', Array.from(allModals).map(m => m.id));
      }
    }

    // Funci√≥n para cerrar modal
    function closeModal(modalId) {
      console.log('üì± Cerrando modal:', modalId);
      const modal = document.getElementById('modal-' + modalId);
      if (modal) {
        const modalContent = modal.querySelector('.modal-container');
        if (modalContent) {
          modalContent.style.transition = 'all 0.2s ease-in';
          modalContent.style.transform = 'scale(0.8) translateY(50px)';
          modalContent.style.opacity = '0';
        }
        
        setTimeout(function() {
          modal.classList.remove('modal-open');
          modal.style.display = 'none';
          modal.style.opacity = '0';
          modal.style.visibility = 'hidden';
          document.body.style.overflow = '';
        }, 200);
        console.log('‚úÖ Modal cerrado:', modalId);
      }
    }

    // Hacer funciones globales
    window.openModal = openModal;
    window.closeModal = closeModal;

    // Event listeners para cerrar modal
    document.addEventListener('click', function(e) {
      const target = e.target;
      const modalClose = target.closest('[data-modal-close]');
      
      if (modalClose) {
        const modalId = modalClose.getAttribute('data-modal-close');
        if (modalId) {
          closeModal(modalId);
        }
      }
    });

    // Cerrar con tecla Escape
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        const openModal = document.querySelector('.modal-overlay.modal-open');
        if (openModal) {
          const modalId = openModal.getAttribute('data-modal-id');
          if (modalId) {
            closeModal(modalId);
          }
        }
      }
    });

    // Debug: Verificar que los modales existan
    const modals = document.querySelectorAll('.modal-overlay');
    console.log('üì± Modales encontrados:', modals.length);
    modals.forEach((modal, index) => {
      console.log(`Modal ${index + 1}:`, modal.id);
    });

    console.log('üéâ SolucionesMobile: Modales configurados correctamente');
  });
</script>

<style>
  /* üåê ECOSISTEMA DE SOLUCIONES MOBILE - ESTILOS SIMPLES SIN ANIMACIONES COMPLEJAS */

  /* AOS manejar√° las animaciones de entrada */

  /* Efecto de gradiente animado para el t√≠tulo */
  .soluciones-titulo {
    background-size: 200% 200%;
    animation: gradientShift 3s ease infinite;
  }

  @keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  /* Efectos hover removidos */

  /* Card central con logo */
  .center-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Efectos hover del card central removidos */

  /* Mejoras en las cards de soluciones */
  .solution-card {
    backdrop-filter: blur(8px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
  }

  .solution-card:hover {
    transform: scale(1.05);
    box-shadow: 0 10px 30px rgba(6, 43, 237, 0.3);
  }

  /* Asegurar que los modales tengan prioridad sobre las cards */
  .modal-overlay {
    z-index: 99999 !important;
  }

  .modal-container {
    z-index: 100000 !important;
  }

  /* Efectos hover de solution-card removidos */

  /* Responsive para tablets y dispositivos medianos */
  @media (max-width: 1024px) and (min-width: 769px) {
    .solution-card .w-12 {
      width: 3rem !important;
      height: 3rem !important;
    }

    .solution-card img {
      width: 2rem !important;
      height: 2rem !important;
    }

    .solution-card h4 {
      font-size: 1rem !important;
      line-height: 1.3 !important;
    }
  }

  /* Responsive para mobile */
  @media (max-width: 768px) {
    .ecosystem-wrapper {
      height: 750px !important;
    }

    .solution-card {
      width: 150px !important;
      height: 150px !important;
      padding: 0.75rem !important;
    }

    .solution-card .flex {
      margin-bottom: 0.5rem !important;
    }

    .solution-card .w-12 {
      width: 2.75rem !important;
      height: 2.75rem !important;
      margin-bottom: 0.5rem !important;
    }

    .solution-card img {
      width: 1.75rem !important;
      height: 1.75rem !important;
    }

    .solution-card h4 {
      font-size: 0.95rem !important;
      line-height: 1.3 !important;
    }

    .card-1 {
      top: 60px !important;
      left: 50% !important;
      transform: translateX(-50%) !important;
    }
    .card-2 {
      top: 135px !important;
      right: 20px !important;
    }
    .card-3 {
      bottom: 135px !important;
      right: 20px !important;
    }
    .card-4 {
      bottom: 60px !important;
      left: 50% !important;
      transform: translateX(-50%) !important;
    }
    .card-5 {
      bottom: 135px !important;
      left: 20px !important;
    }
    .card-6 {
      top: 135px !important;
      left: 20px !important;
    }
    .card-7 {
      top: 299px !important;
      right: -10px !important;
    }
    .card-8 {
      top: 299px !important;
      left: -10px !important;
    }
  }

  @media (max-width: 480px) {
    .ecosystem-wrapper {
      height: 650px !important;
    }

    .solution-card {
      width: 140px !important;
      height: 140px !important;
      padding: 0.5rem !important;
    }

    .solution-card .w-12 {
      width: 2.25rem !important;
      height: 2.25rem !important;
      margin-bottom: 0.25rem !important;
    }

    .solution-card img {
      width: 1.5rem !important;
      height: 1.5rem !important;
    }

    .solution-card h4 {
      font-size: 0.85rem !important;
      line-height: 1.25 !important;
    }

    .card-1 {
      top: 60px !important;
      left: 50% !important;
      transform: translateX(-50%) !important;
    }
    .card-2 {
      top: 135px !important;
      right: 20px !important;
    }
    .card-3 {
      bottom: 135px !important;
      right: 20px !important;
    }
    .card-4 {
      bottom: 60px !important;
      left: 50% !important;
      transform: translateX(-50%) !important;
    }
    .card-5 {
      bottom: 135px !important;
      left: 20px !important;
    }
    .card-6 {
      top: 135px !important;
      left: 20px !important;
    }
    .card-7 {
      top: 254px !important;
      right: -10px !important;
    }
    .card-8 {
      top: 254px !important;
      left: -10px !important;
    }
  }
</style>
